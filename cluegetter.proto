package main;

message Proto_Message_v1 {

    required uint64 instanceId = 1;
    required Session session   = 2;

    required string id      = 3;
    required string from    = 4;
    repeated string rcpt    = 5;
    repeated Header headers = 6;
    required bytes  body    = 7;

    required Verdict verdict               = 8;
    required string verdictMsg             = 9;
    required double rejectScore            = 10;
    required double rejectScoreThreshold   = 11;
    required double tempfailScore          = 12;
    required double tempfailScoreThreshold = 13;

    repeated CheckResult checkResults  = 14;

    message Session {
        required bytes  id              = 1;
        required uint64 timeStart       = 2;
        optional uint64 timeEnd         = 3;

        optional string saslUsername    = 4;
        optional string saslSender      = 5;
        optional string saslMethod      = 6;
        optional string certIssuer      = 7;
        optional string certSubject     = 8;
        optional uint32 cipherBits      = 9;
        optional string cipher          = 10;
        optional string tlsVersion      = 11;

        required string ip              = 12;
        optional string reverseDns      = 13;
        optional string hostname        = 14;
        optional string helo            = 15;
        optional string mtaHostName     = 16;
        optional string mtaDaemonName   = 17;
    }

    message Header {
        required string key     = 1;
        required string value   = 2;
    }

    message CheckResult {
        required string message_id    = 1;
        required string module        = 2;
        required Verdict verdict      = 3;
        required double score         = 4;
        required double weightedScore = 5;
        required double duration      = 6;
        optional bytes  determinants  = 7;
    }

    enum Verdict {
        PERMIT   = 0;
        TEMPFAIL = 1;
        REJECT   = 2;
        ERROR    = 4;
    }

}
